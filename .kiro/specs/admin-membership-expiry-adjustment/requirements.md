# 需求文档

## 介绍

此功能为管理员后台添加手动调整会员到期时间的功能。允许管理员手动修改用户的会员到期日期，用于测试目的，特别是测试会员到期后的积分重置功能。该功能将集成到现有的管理员用户管理界面中。

## 需求

### 需求 1

**用户故事：** 作为管理员，我希望能够手动调整用户的会员到期时间，以便我可以测试会员到期和积分重置功能，而无需等待实际的到期日期。

#### 验收标准

1. 当管理员访问用户管理部分时，系统应显示每个用户的"调整会员到期时间"选项
2. 当管理员点击调整会员到期时间选项时，系统应打开一个模态框，显示当前会员到期日期和新到期日期的输入字段
3. 当管理员选择新的到期日期时，系统应验证日期格式是否有效（YYYY-MM-DD HH:mm:ss）
4. 当管理员提交新的到期日期时，系统应更新数据库中用户的membership_end字段
5. 当会员到期日期成功更新时，系统应在管理员日志中记录此操作
6. 当会员到期日期成功更新时，系统应向管理员显示成功消息

### 需求 2

**用户故事：** 作为管理员，我希望能够清楚地看到当前的会员状态和到期日期，以便我可以做出明智的调整决定。

#### 验收标准

1. 当管理员查看用户信息时，系统应显示当前会员状态（活跃/已过期）
2. 当管理员查看用户信息时，系统应以可读格式显示当前会员到期日期
3. 当管理员查看用户信息时，系统应显示会员等级（入门/标准/高级）
4. 当用户没有活跃会员时，系统应显示"无会员"状态

### 需求 3

**用户故事：** 作为管理员，我希望系统能够正确处理边界情况，以便调整功能稳健可靠。

#### 验收标准

1. 当管理员尝试设置过去的到期日期时，系统应允许此操作（用于测试过期会员）
2. 当管理员尝试设置无效日期格式时，系统应显示错误消息并阻止提交
3. 当更新过程中发生数据库错误时，系统应显示适当的错误消息
4. 当管理员调整到期日期时，系统应刷新用户列表以显示更新的信息
5. 当操作失败时，系统不应创建管理员日志条目

### 需求 4

**用户故事：** 作为管理员，我希望调整操作被记录，以便有会员修改的审计跟踪。

#### 验收标准

1. 当管理员成功调整会员到期日期时，系统应创建管理员日志条目
2. 创建日志条目时，系统应包含目标用户邮箱、旧到期日期、新到期日期和原因
3. 创建日志条目时，系统应将operation_type设置为"adjust_membership_expiry"
4. 创建日志条目时，系统应包含执行操作的管理员用户
5. 查看管理员日志时，系统应清晰详细地显示会员到期时间调整记录