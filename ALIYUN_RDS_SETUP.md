# 阿里云RDS MySQL Serverless 配置指南

## 📋 准备工作

### 前置条件
- 阿里云账号（已实名认证）
- 账户余额充足（建议至少100元）
- 已开通云数据库RDS服务

---

## 🚀 第一步：创建RDS实例

### 1.1 登录阿里云控制台
1. 访问 [阿里云控制台](https://ecs.console.aliyun.com/)
2. 登录你的阿里云账号
3. 在产品与服务中搜索"RDS"，点击进入

### 1.2 创建实例
1. 点击 **"创建实例"** 按钮
2. 选择以下配置：

#### 基础配置
```
计费方式: 按量付费（推荐新手）
地域: 华东1（杭州）或离你最近的地域
可用区: 随机分配
数据库引擎: MySQL
版本: 8.0
系列: Serverless
```

#### 规格配置
```
Serverless规格: 
- 最小RCU: 0.5
- 最大RCU: 1（可后续调整）
- 自动暂停时间: 10分钟
```

#### 存储配置
```
存储类型: SSD云盘
存储空间: 20GB（自动扩展）
```

#### 网络配置
```
网络类型: 专有网络VPC
专有网络: 默认VPC（如果没有会自动创建）
交换机: 自动选择
```

### 1.3 确认订单
- 检查配置信息
- 预估费用约 ¥30-50/月
- 点击 **"立即购买"**

---

## 🔧 第二步：配置数据库

### 2.1 等待实例创建
- 创建过程约需要3-5分钟
- 状态变为 **"运行中"** 后继续

### 2.2 设置白名单
1. 在实例列表中点击实例ID
2. 左侧菜单选择 **"数据安全性"** > **"白名单设置"**
3. 点击 **"修改"** 按钮
4. 添加以下IP地址：
   ```
   0.0.0.0/0  （临时设置，用于测试）
   ```
   ⚠️ **生产环境请设置具体IP地址**

### 2.3 创建数据库账号
1. 左侧菜单选择 **"账号管理"**
2. 点击 **"创建账号"**
3. 填写信息：
   ```
   数据库账号: app_user
   账号类型: 普通账号
   密码: 设置一个强密码（建议包含大小写字母、数字、特殊字符）
   确认密码: 重复输入密码
   ```
4. 点击 **"确定"**

### 2.4 创建数据库
1. 左侧菜单选择 **"数据库管理"**
2. 点击 **"创建数据库"**
3. 填写信息：
   ```
   数据库名称: xhs_create_v3
   支持字符集: utf8mb4
   排序规则: utf8mb4_unicode_ci
   授权账号: app_user
   账号权限: 读写
   描述: 小红书创作工具数据库
   ```
4. 点击 **"确定"**

---

## 📝 第三步：获取连接信息

### 3.1 查看连接地址
1. 在实例详情页面
2. 查看 **"基本信息"** 中的连接地址
3. 记录以下信息：
   ```
   内网地址: rm-xxxxx.mysql.rds.aliyuncs.com
   端口: 3306
   数据库名: xhs_create_v3
   用户名: app_user
   密码: [你设置的密码]
   ```

### 3.2 测试连接（可选）
使用MySQL客户端工具测试连接：
```bash
mysql -h rm-xxxxx.mysql.rds.aliyuncs.com -P 3306 -u app_user -p xhs_create_v3
```

---

## 🗃️ 第四步：执行数据库脚本

### 4.1 连接数据库
使用以下任一方式连接：
- **DMS数据管理**（推荐）：阿里云控制台 > 数据库 > 登录数据库
- **命令行工具**：mysql客户端
- **图形化工具**：Navicat、MySQL Workbench等

### 4.2 执行迁移脚本
1. 打开 `mysql_migrations/001_create_database_schema.sql` 文件
2. 复制所有内容
3. 在数据库管理工具中执行

### 4.3 启用事件调度器
执行以下SQL命令：
```sql
SET GLOBAL event_scheduler = ON;
```

### 4.4 验证安装
执行以下查询验证表是否创建成功：
```sql
SHOW TABLES;
```

应该看到以下表：
- users
- profiles
- email_verification_codes
- batch_tasks
- task_notes
- generated_contents
- credit_transactions

---

## 🔐 第五步：安全配置

### 5.1 更新白名单（生产环境）
将白名单从 `0.0.0.0/0` 更改为具体的IP地址：
- 你的开发机器IP
- 服务器IP（如果部署到云服务器）

### 5.2 启用SSL连接（推荐）
1. 在实例详情页面
2. 左侧菜单 **"数据安全性"** > **"SSL"**
3. 开启SSL加密
4. 下载SSL证书

---

## 💰 第六步：成本优化

### 6.1 Serverless配置调优
根据实际使用情况调整：
```
低流量应用:
- 最小RCU: 0.5
- 最大RCU: 1
- 自动暂停: 10分钟

中等流量应用:
- 最小RCU: 1
- 最大RCU: 2
- 自动暂停: 30分钟
```

### 6.2 监控设置
1. 开启监控告警
2. 设置RCU使用率告警
3. 设置连接数告警

---

## 📊 连接信息汇总

完成配置后，你将获得以下连接信息：

```env
# 阿里云RDS MySQL配置
DB_HOST=rm-xxxxx.mysql.rds.aliyuncs.com
DB_PORT=3306
DB_NAME=xhs_create_v3
DB_USER=app_user
DB_PASSWORD=你设置的密码
DB_CHARSET=utf8mb4
```

---

## 🚨 常见问题

### Q1: 无法连接数据库
**A:** 检查白名单设置，确保你的IP地址在白名单中

### Q2: 提示账号权限不足
**A:** 确认账号类型为"普通账号"，并且有数据库的读写权限

### Q3: Serverless实例自动暂停
**A:** 这是正常现象，第一次连接可能需要几秒钟唤醒

### Q4: 费用比预期高
**A:** 检查RCU配置，调整最大RCU值和自动暂停时间

---

## 📞 技术支持

如果遇到问题，可以：
1. 查看阿里云RDS官方文档
2. 提交工单给阿里云技术支持
3. 在阿里云开发者社区寻求帮助

---

## ✅ 配置完成检查清单

- [ ] RDS实例创建成功
- [ ] 白名单配置正确
- [ ] 数据库账号创建成功
- [ ] 数据库创建成功
- [ ] 数据库脚本执行成功
- [ ] 事件调度器已启用
- [ ] 连接信息已记录
- [ ] 安全配置已完成

完成以上步骤后，你的阿里云RDS MySQL Serverless就配置完成了！ 