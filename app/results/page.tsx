"use client"

import { useState, useEffect, Suspense, useMemo } from "react"
import { useSearchParams } from "next/navigation"
import { Header } from "@/components/header"
import { TaskSidebar } from "@/components/task-sidebar"
import { ResultViewer } from "@/components/result-viewer"

interface GeneratedContent {
  id: string
  title: string
  content: string
  status: "generating" | "completed" | "failed"
}

interface Task {
  id: string
  noteTitle: string
  noteCover: string
  status: "generating" | "completed" | "failed"
  results: GeneratedContent[]
}

function ResultsPageContent() {
  const searchParams = useSearchParams()
  const [selectedTaskId, setSelectedTaskId] = useState<string>("")
  const [tasks, setTasks] = useState<Task[]>([])

  // ä½¿ç”¨ useMemo æ¥é¿å…é‡å¤è®¡ç®—
  const mockTasks = useMemo(() => {
    const noteIds = searchParams?.get("notes")?.split(",") || []
    const count = Number.parseInt(searchParams?.get("count") || "3")

    return noteIds.map((noteId, index) => ({
      id: `task-${index}`,
      noteTitle: `è¶…å¥½ç”¨çš„æŠ¤è‚¤å“åˆ†äº«ï¼è¿™äº›å¹³ä»·å¥½ç‰©ç»å¯¹ä¸è¸©é›·`,
      noteCover: "https://images.unsplash.com/photo-1556228578-8c89e6adf883?w=300&h=400&fit=crop&crop=center",
      status: "completed" as const,
      results: Array.from({ length: count }, (_, i) => ({
        id: `result-${index}-${i}`,
        title: [
          "ðŸŒŸ è¶…å…¨æŠ¤è‚¤å“æµ‹è¯„ï¼è¿™äº›å¹³ä»·å¥½ç‰©è®©ä½ ç¾Žåˆ°å‘å…‰",
          "ðŸ’Ž æŠ¤è‚¤ç•Œçš„éšè—å®è—ï¼å­¦ç”Ÿå…šå¿…å¤‡çš„å¹³ä»·ç¥žå™¨",
          "âœ¨ é—­çœ¼å…¥çš„æŠ¤è‚¤å¥½ç‰©æ¸…å•ï¼Œæ¯ä¸€æ¬¾éƒ½æ˜¯çœŸçˆ±æŽ¨è",
        ][i],
        content: [
          `å§å¦¹ä»¬å¥½å‘€ï¼ä»Šå¤©ç»™å¤§å®¶åˆ†äº«å‡ æ¬¾æˆ‘æœ€è¿‘åœ¨ç”¨çš„æŠ¤è‚¤å“ï¼Œéƒ½æ˜¯ç»è¿‡æˆ‘äº²æµ‹æœ‰æ•ˆçš„å®è—å¥½ç‰©ï¼æ¯ä¸€æ¬¾éƒ½æœ‰è¯¦ç»†çš„ä½¿ç”¨æ„Ÿå—ï¼Œç»å¯¹ä¸è¸©é›·ï¼

ðŸ’§ æ´é¢ç¯‡
è¿™æ¬¾æ°¨åŸºé…¸æ´é¢çœŸçš„å¤ªæ¸©å’Œäº†ï¼æ•æ„Ÿè‚Œä¹Ÿèƒ½æ”¾å¿ƒä½¿ç”¨ï¼Œæ´—å®Œè„¸ä¸ç´§ç»·ï¼Œè¿˜æœ‰æ·¡æ·¡çš„é¦™å‘³ã€‚ä»·æ ¼ä¹Ÿå¾ˆç¾Žä¸½ï¼Œå­¦ç”Ÿå…šå¿…å¤‡ï¼

ðŸ§´ ç²¾åŽç¯‡  
çƒŸé…°èƒºç²¾åŽçœŸçš„æ˜¯æˆ‘çš„å¿ƒå¤´å¥½ï¼åšæŒç”¨äº†ä¸€ä¸ªæœˆï¼Œæ¯›å­”æ˜Žæ˜¾ç»†è…»äº†å¾ˆå¤šï¼Œè€Œä¸”æäº®æ•ˆæžœä¹Ÿå¾ˆæ˜Žæ˜¾ã€‚å»ºè®®æ™šä¸Šä½¿ç”¨ï¼Œç™½å¤©è®°å¾—é˜²æ™’å“¦ï½ž

ðŸ§´ é¢éœœç¯‡
è¿™æ¬¾é¢éœœçš„è´¨åœ°å¾ˆè½»è–„ï¼Œä½†ä¿æ¹¿æ•ˆæžœè¶…çº§å¥½ï¼å³ä½¿æ˜¯æ²¹çš®ç”¨äº†ä¹Ÿä¸ä¼šè§‰å¾—åŽšé‡ï¼Œè€Œä¸”å¸æ”¶å¾ˆå¿«ï¼Œæ—©æ™šéƒ½å¯ä»¥ç”¨ã€‚

âœ¨ ä½¿ç”¨å°è´´å£«ï¼š
1. æ´é¢åŽå…ˆç”¨çˆ½è‚¤æ°´æ‰“åº•
2. ç²¾åŽè¦æŒ‰æ‘©è‡³å®Œå…¨å¸æ”¶  
3. é¢éœœè¦ä»Žå†…å‘å¤–è½»æ‹
4. ç™½å¤©ä¸€å®šè¦åšå¥½é˜²æ™’ï¼

å§å¦¹ä»¬æœ‰ä»€ä¹ˆæƒ³äº†è§£çš„æŠ¤è‚¤å“å¯ä»¥åœ¨è¯„è®ºåŒºå‘Šè¯‰æˆ‘ï¼Œæˆ‘ä¼šç»§ç»­ä¸ºå¤§å®¶æµ‹è¯„æ›´å¤šå¥½ç‰©çš„ï¼

#æŠ¤è‚¤å“æŽ¨è #å¹³ä»·å¥½ç‰© #æŠ¤è‚¤å¿ƒå¾—`,

          `å“ˆå–½å¤§å®¶å¥½ï¼ä½œä¸ºä¸€ä¸ªæŠ¤è‚¤çˆ±å¥½è€…ï¼Œä»Šå¤©å¿…é¡»è¦è·Ÿå¤§å®¶åˆ†äº«è¿™å‡ æ¬¾æˆ‘å›žè´­äº†æ— æ•°æ¬¡çš„æŠ¤è‚¤ç¥žå™¨ï¼

ðŸŒ¸ æ¸…æ´åŠ›MAXçš„æ´é¢ä¹³
è¿™æ¬¾æ´é¢ä¹³çœŸçš„æ˜¯æˆ‘ç”¨è¿‡æœ€å¥½ç”¨çš„ï¼æ³¡æ²«ä¸°å¯Œç»†è…»ï¼Œæ¸…æ´åŠ›è¶…å¼ºä½†ä¸åˆºæ¿€ï¼Œç”¨å®Œçš®è‚¤æ»‘æ»‘å«©å«©çš„ï¼Œè€Œä¸”ä»·æ ¼è¶…çº§å‹å¥½ï¼

ðŸ’« æ¯›å­”æ•‘æ˜Ÿç²¾åŽæ¶²
è¯´åˆ°ç²¾åŽï¼Œè¿™æ¬¾çƒŸé…°èƒºç²¾åŽå¿…é¡»æ‹¥æœ‰å§“åï¼æˆ‘ç”¨äº†ä¸¤ä¸ªæœˆï¼Œé»‘å¤´æ˜Žæ˜¾å‡å°‘ï¼Œæ¯›å­”ä¹Ÿæ”¶ç¼©äº†ä¸å°‘ã€‚é‡ç‚¹æ˜¯ä¸ä¼šæ“æ³¥ï¼Œå¸æ”¶å¾ˆå¿«ï¼

ðŸŒ™ å¤œé—´ä¿®æŠ¤é¢éœœ
æ™šä¸ŠæŠ¤è‚¤çš„æœ€åŽä¸€æ­¥å°±é å®ƒäº†ï¼è´¨åœ°è½»ç›ˆä¸åŽšé‡ï¼Œä½†æ»‹æ¶¦åº¦åˆšåˆšå¥½ã€‚æ—©ä¸Šèµ·æ¥çš®è‚¤çŠ¶æ€ç‰¹åˆ«å¥½ï¼Œæ°´æ¶¦æœ‰å…‰æ³½ï¼

ðŸ’¡ æŠ¤è‚¤å¿ƒå¾—åˆ†äº«ï¼š
â€¢ é€‰æ‹©é€‚åˆè‡ªå·±è‚¤è´¨çš„äº§å“æœ€é‡è¦
â€¢ åšæŒä½¿ç”¨æ‰èƒ½çœ‹åˆ°æ•ˆæžœ
â€¢ é˜²æ™’æ˜¯æŠ¤è‚¤çš„æœ€åŽä¸€æ­¥ï¼Œåƒä¸‡ä¸èƒ½å¿½ç•¥
â€¢ æŠ¤è‚¤å“è¦å¾ªåºæ¸è¿›åœ°æ·»åŠ ï¼Œä¸è¦ä¸€æ¬¡ç”¨å¤ªå¤šæ–°äº§å“

å¸Œæœ›è¿™äº›åˆ†äº«å¯¹å¤§å®¶æœ‰å¸®åŠ©ï¼æœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿Žåœ¨è¯„è®ºåŒºäº¤æµï½ž

#æŠ¤è‚¤æ—¥è®° #å¥½ç‰©åˆ†äº« #ç¾Žå¦†æµ‹è¯„`,

          `å°ä»™å¥³ä»¬é›†åˆå•¦ï¼ä»Šå¤©è¦è·Ÿå¤§å®¶åˆ†äº«æˆ‘çš„æŠ¤è‚¤å¿ƒå¾—ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘è¸©è¿‡å‘æ€»ç»“å‡ºæ¥çš„ç»éªŒï¼

ðŸŽ¯ æ´é¢äº§å“é€‰æ‹©æŒ‡å—
æ°¨åŸºé…¸æ´é¢çœŸçš„æ˜¯æ•æ„Ÿè‚Œçš„æ•‘æ˜Ÿï¼æ¸©å’Œä¸åˆºæ¿€ï¼Œæ¸…æ´åŠ›ä¹Ÿå¤Ÿï¼Œç”¨äº†è¿™ä¹ˆä¹…çš®è‚¤çŠ¶æ€è¶Šæ¥è¶Šç¨³å®šã€‚è®°ä½ï¼Œæ´é¢ä¸æ˜¯è¶Šè´µè¶Šå¥½ï¼Œé€‚åˆè‡ªå·±æœ€é‡è¦ï¼

ðŸ”¥ ç²¾åŽä½¿ç”¨æŠ€å·§
çƒŸé…°èƒºç²¾åŽå»ºè®®ä»Žä½Žæµ“åº¦å¼€å§‹ç”¨ï¼Œè®©çš®è‚¤æœ‰ä¸ªé€‚åº”è¿‡ç¨‹ã€‚æˆ‘çŽ°åœ¨æ¯å¤©æ™šä¸Šç”¨ï¼Œé…åˆæŒ‰æ‘©æ‰‹æ³•ï¼Œæ•ˆæžœçœŸçš„å¾ˆæ˜Žæ˜¾ï¼

ðŸŒŸ é¢éœœæ¶‚æŠ¹æ–¹æ³•
å¾ˆå¤šäººé¢éœœéƒ½æ˜¯éšä¾¿æŠ¹æŠ¹ï¼Œå…¶å®žæ­£ç¡®çš„æ¶‚æŠ¹æ–¹æ³•å¾ˆé‡è¦ï¼è¦ä»Žè„¸éƒ¨ä¸­å¤®å‘å¤–è½»æ‹ï¼Œè¿™æ ·æ‰èƒ½æ›´å¥½åœ°å¸æ”¶ã€‚

ðŸ“ æˆ‘çš„æŠ¤è‚¤æ—¶é—´è¡¨ï¼š
æ—©ä¸Šï¼šæ´é¢ â†’ çˆ½è‚¤æ°´ â†’ ç²¾åŽ â†’ é¢éœœ â†’ é˜²æ™’
æ™šä¸Šï¼šå¸å¦† â†’ æ´é¢ â†’ çˆ½è‚¤æ°´ â†’ ç²¾åŽ â†’ é¢éœœ

åšæŒè¿™ä¸ªæ­¥éª¤ä¸€ä¸ªæœˆï¼Œçš®è‚¤çŠ¶æ€çœŸçš„ä¼šæœ‰å¾ˆå¤§æ”¹å–„ï¼æœ€é‡è¦çš„æ˜¯è¦æœ‰è€å¿ƒï¼ŒæŠ¤è‚¤æ˜¯ä¸€ä¸ªé•¿æœŸçš„è¿‡ç¨‹ã€‚

å¤§å®¶è¿˜æƒ³äº†è§£ä»€ä¹ˆæŠ¤è‚¤çŸ¥è¯†ï¼Œè¯„è®ºåŒºå‘Šè¯‰æˆ‘å“¦ï¼

#æŠ¤è‚¤æ•™ç¨‹ #æŠ¤è‚¤æ­¥éª¤ #ç¾Žè‚Œç§˜ç±`,
        ][i],
        status: "completed" as const,
      })),
    }))
  }, [searchParams])

  // ä½¿ç”¨ useEffect æ¥è®¾ç½®åˆå§‹çŠ¶æ€ï¼Œæ·»åŠ ä¾èµ–æ•°ç»„
  useEffect(() => {
    setTasks(mockTasks)
    if (mockTasks.length > 0 && !selectedTaskId) {
      setSelectedTaskId(mockTasks[0].id)
    }
  }, [mockTasks, selectedTaskId])

  const selectedTask = tasks.find((task) => task.id === selectedTaskId)

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-indigo-900 transition-colors duration-300">
      <Header />
      <div className="pt-20 h-screen flex">
        {/* Left Sidebar */}
        <TaskSidebar tasks={tasks} selectedTaskId={selectedTaskId} onTaskSelect={setSelectedTaskId} />

        {/* Main Content */}
        <div className="flex-1 overflow-hidden">
          {selectedTask ? (
            <ResultViewer task={selectedTask} />
          ) : (
            <div className="flex items-center justify-center h-full text-gray-500 dark:text-gray-400 text-xl">
              è¯·é€‰æ‹©ä¸€ä¸ªä»»åŠ¡æŸ¥çœ‹ç»“æžœ
            </div>
          )}
        </div>
      </div>
    </div>
  )
}

export default function ResultsPage() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <ResultsPageContent />
    </Suspense>
  )
}
